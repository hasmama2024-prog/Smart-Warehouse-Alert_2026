<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠØ©</title>
    <style>
        /* ===== PREMIUM DESIGN SYSTEM - (CSS Ø§Ù„Ø£ØµÙ„ÙŠ) ===== */
        :root {
            --primary-dark: #0f172a;
            --secondary-dark: #1e293b;
            --accent-blue: #3b82f6;
            --accent-red: #ef4444;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            /* New: Profit/Loss Colors */
            --profit-color: #10b981; /* Green */
            --loss-color: #ef4444;   /* Red */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, #0c1220 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* HEADER - GLASSMORPHISM */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-blue), #60a5fa);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-widget {
            position: relative;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
        }

        .notification-widget:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-red);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }

        /* MAIN LAYOUT */
        .dashboard-wrapper {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* SIDEBAR - MINIMALIST */
        .sidebar {
            width: 260px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 30px 0;
            border-left: 1px solid var(--glass-border);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 30px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            margin: 0 15px;
            border-radius: 8px;
        }

        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--accent-blue);
            color: white;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .nav-icon {
            width: 20px;
            font-size: 18px;
        }

        /* CONTENT AREA */
        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to left, var(--border-color), transparent);
        }

        /* STATS CARDS - GLASSMORPHISM */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: var(--accent-blue);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.urgent {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .stat-icon.new {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-orange);
        }

        .stat-icon.solved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            margin: 10px 0;
        }

        .stat-value.urgent { color: var(--accent-red); }
        .stat-value.new { color: var(--accent-orange); }
        .stat-value.solved { color: var(--accent-green); }

        .stat-change {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* FILTER BAR - MINIMALIST */
        .filter-bar {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .filter-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-input {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* TABLE - PREMIUM */
        .table-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn-warning {
            background: var(--accent-orange);
            color: var(--primary-dark);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 16px 25px;
            text-align: right;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
        }

        td {
            padding: 16px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        tr:hover td {
            background: rgba(59, 130, 246, 0.05);
        }

        .product-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .product-image {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-blue), #60a5fa);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .product-info {
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .product-category {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stock-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .stock-critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .stock-low {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-orange);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-new {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-orange);
        }

        .status-read {
            background: rgba(100, 116, 139, 0.2);
            color: #64748b;
        }

        .status-solved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .status-ignored {
            background: rgba(107, 114, 128, 0.2);
            color: #6b7280;
        }

        .action-cell {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.05);
            color: var(--text-secondary);
        }

        .icon-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-blue);
            transform: scale(1.1);
        }

        .icon-btn.danger:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .icon-btn.success:hover {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        /* MODAL - GLASSMORPHISM */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            animation: modalSlide 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalSlide {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--accent-red);
        }

        .modal-body {
            padding: 25px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        /* New: Profit/Loss Display */
        .profit-status {
            font-weight: bold;
            font-size: 18px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .profit-status.is-profit {
            color: var(--profit-color);
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid var(--profit-color);
        }
        .profit-status.is-loss {
            color: var(--loss-color);
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid var(--loss-color);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
                position: absolute;
            }

            .main-content {
                margin-right: 0;
                padding: 20px;
            }

            .header {
                padding: 15px 20px;
            }

            .dashboard-wrapper {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-controls {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .action-buttons {
                justify-content: stretch;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }
        }

        /* ANIMATIONS */
        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
</head>
<body>
    <div id="loader" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 2001;">
        <div style="width: 50px; height: 50px; border: 4px solid rgba(59, 130, 246, 0.3); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s ease-in-out infinite;"></div>
    </div>

    <header class="header">
        <div class="brand">
            <div class="brand-icon">ğŸ‘”</div>
            <span>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠØ©</span>
        </div>
        
        <div class="user-section">
            <div class="notification-widget" onclick="showNotifications()">
                ğŸ””
                <span class="notification-badge" id="notificationCount">3</span>
            </div>
            <select style="background: transparent; border: 1px solid var(--glass-border); color: white; padding: 8px 12px; border-radius: 8px;">
                <option>ğŸ‘¤ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ù†ØµÙ</option>
                <option>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</option>
                <option>ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</option>
            </select>
        </div>
    </header>

    <div class="dashboard-wrapper">
        <nav class="sidebar">
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ›’</span>
                <span>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ‘•</span>
                <span>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
            </a>
            <a href="#" class="nav-item active">
                <span class="nav-icon">ğŸ“¦</span>
                <span>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ·ï¸</span>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ“ˆ</span>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">ğŸ‘¥</span>
                <span>Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</span>
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">âš™ï¸</span>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
        </nav>

        <main class="content">
            <div class="page-title animate-in">
                <span>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
                <small style="font-size: 14px; color: var(--text-secondary); font-weight: 400;">
                    Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">2025-12-11 14:30:25</span>
                </small>
            </div>

            <div class="stats-grid animate-in">
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-title">ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ø§Ø¬Ù„</div>
                            <div class="stat-value urgent" id="urgentCount">2</div>
                            <div class="stat-change">Ø§Ù†Ø®ÙØ§Ø¶ Ø¨Ù†Ø³Ø¨Ø© 40% Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                        </div>
                        <div class="stat-icon urgent">ğŸš¨</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-title">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                            <div class="stat-value new" id="newCount">3</div>
                            <div class="stat-change">+2 Ù…Ù†Ø° Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©</div>
                        </div>
                        <div class="stat-icon new">ğŸ“¢</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-title">ØªÙ… Ø­Ù„Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ…</div>
                            <div class="stat-value solved" id="solvedCount">5</div>
                            <div class="stat-change">Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø² ğŸ”¥</div>
                        </div>
                        <div class="stat-icon solved">âœ…</div>
                    </div>
                </div>
            </div>

            <div class="filter-bar animate-in">
                <div class="filter-title">ğŸ” ØªØµÙÙŠØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</label>
                        <select class="filter-input" id="statusFilter" onchange="filterAlerts()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</option>
                            <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ù…Ù‚Ø±ÙˆØ¡">Ù…Ù‚Ø±ÙˆØ¡</option>
                            <option value="Ù…Ø­Ù„ÙˆÙ„">Ù…Ø­Ù„ÙˆÙ„</option>
                            <option value="Ù…ØªØ¬Ø§Ù‡Ù„">Ù…ØªØ¬Ø§Ù‡Ù„</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" class="filter-input" id="productFilter" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="filterAlerts()">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="filter-input" id="dateFrom" onchange="filterAlerts()">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="filter-input" id="dateTo" onchange="filterAlerts()">
                    </div>
                </div>
                <div class="btn-group" style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="filterAlerts()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    <button class="btn btn-secondary" onclick="refreshData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-warning" onclick="generateBatchPurchaseOrder()">ğŸ“œ ØªØ¬Ù…ÙŠØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø© Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</button>
                </div>
            </div>

            <div class="table-container animate-in">
                <div class="table-header">
                    <div class="table-title">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="exportToExcel()">ğŸ“¤ ØªØµØ¯ÙŠØ± Excel</button>
                        <button class="btn btn-secondary" onclick="printAlerts()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    </div>
                </div>
                
                <table id="alertsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
                            <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù‚Øµ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="alertsTableBody">
                        </tbody>
                </table>
            </div>
        </main>
    </div>

    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“‹ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡</div>
                <button class="modal-close" onclick="closeModal('purchaseModal')">&times;</button>
            </div>
            <div class="modal-body" id="purchaseModalBody">
                </div>
        </div>
    </div>

    <div class="modal" id="saleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ·ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ ØªØ®ÙÙŠØ¶</div>
                <button class="modal-close" onclick="closeModal('saleModal')">&times;</button>
            </div>
            <div class="modal-body" id="saleModalBody">
                </div>
        </div>
    </div>

    <div class="popup-notification" id="popupNotification" style="display: none; position: fixed; bottom: 20px; right: 20px; background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 10px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);">
        <strong>ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯!</strong><br>
        <span id="popupMessage"></span>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹)
        let alerts = [
            {
                id: 1,
                product: 'Ù‚Ù…ÙŠØµ Ø£Ø¨ÙŠØ¶ L',
                barcode: '123456789',
                currentStock: 0,
                minLevel: 10,
                alertDate: '2025-12-11 08:30:15',
                status: 'Ø¬Ø¯ÙŠØ¯',
                category: 'Ù‚Ù…ØµØ§Ù†',
                costPrice: 50.00,  // Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
                sellingPrice: 85.00 // Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠ
            },
            {
                id: 2,
                product: 'Ø¨Ù†Ø·Ù„ÙˆÙ† Ø¬ÙŠÙ†Ø² M',
                barcode: '987654321',
                currentStock: 3,
                minLevel: 10,
                alertDate: '2025-12-11 09:15:42',
                status: 'Ø¬Ø¯ÙŠØ¯',
                category: 'Ø¨Ù†Ø§Ø·ÙŠÙ„',
                costPrice: 90.00,
                sellingPrice: 150.00
            },
            {
                id: 3,
                product: 'Ø¬Ø§ÙƒÙŠØª Ø£Ø³ÙˆØ¯ XL',
                barcode: '1122334455',
                currentStock: 5,
                minLevel: 8,
                alertDate: '2025-12-10 16:45:30',
                status: 'Ù…Ù‚Ø±ÙˆØ¡',
                category: 'Ø¬Ø§ÙƒÙŠØªØ§Øª',
                costPrice: 150.00,
                sellingPrice: 280.00
            },
            {
                id: 4,
                product: 'ØªÙŠØ´ÙŠØ±Øª Ø±ÙŠØ§Ø¶ÙŠ S',
                barcode: '5566778899',
                currentStock: 2,
                minLevel: 15,
                alertDate: '2025-12-09 11:20:10',
                status: 'Ù…Ø­Ù„ÙˆÙ„',
                category: 'ØªÙŠØ´ÙŠØ±ØªØ§Øª',
                costPrice: 30.00,
                sellingPrice: 55.00
            }
        ];

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.onload = function() {
            loadAlerts();
            updateStats();
            updateTime();
            setInterval(updateTime, 1000);
            // setInterval(simulateNewAlert, 45000); // ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯ ÙƒÙ„ 45 Ø«Ø§Ù†ÙŠØ©
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function loadAlerts(filteredAlerts = null) {
            const data = filteredAlerts || alerts;
            const tbody = document.getElementById('alertsTableBody');
            
            tbody.innerHTML = data.map((alert, index) => {
                const shortagePercent = Math.round(((alert.minLevel - alert.currentStock) / alert.minLevel) * 100);
                const urgencyClass = alert.currentStock === 0 ? 'stock-critical' : 
                                   alert.currentStock <= alert.minLevel * 0.5 ? 'stock-low' : '';
                
                return `
                    <tr class="animate-in" style="animation-delay: ${index * 0.05}s">
                        <td>
                            <div class="product-cell">
                                <div class="product-image">ğŸ‘•</div>
                                <div class="product-info">
                                    <div class="product-name">${alert.product}</div>
                                    <div class="product-category">${alert.category}</div>
                                </div>
                            </div>
                        </td>
                        <td>${alert.barcode}</td>
                        <td>
                            <span class="stock-indicator ${urgencyClass}">
                                ${alert.currentStock === 0 ? 'ğŸš¨ Ù†ÙØ°' : alert.currentStock}
                            </span>
                        </td>
                        <td>${alert.minLevel}</td>
                        <td style="font-weight: 600; color: ${shortagePercent > 75 ? '#ef4444' : '#f59e0b'};">
                            ${shortagePercent > 0 ? `-${shortagePercent}%` : '0%'}
                        </td>
                        <td style="font-size: 13px; color: var(--text-secondary);">${alert.alertDate}</td>
                        <td>
                            <span class="status-badge status-${alert.status === 'Ø¬Ø¯ÙŠØ¯' ? 'new' : alert.status === 'Ù…Ù‚Ø±ÙˆØ¡' ? 'read' : alert.status === 'Ù…Ø­Ù„ÙˆÙ„' ? 'solved' : 'ignored'}">
                                ${alert.status}
                            </span>
                        </td>
                        <td>
                            <div class="action-cell">
                                ${getActionButtons(alert)}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getActionButtons(alert) {
            if (alert.status === 'Ù…Ø­Ù„ÙˆÙ„') {
                return '<button class="icon-btn" onclick="viewDetails(' + alert.id + ')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">ğŸ‘ï¸</button>';
            } else if (alert.status === 'Ù…ØªØ¬Ø§Ù‡Ù„') {
                return '<button class="icon-btn" onclick="restoreAlert(' + alert.id + ')" title="Ø§Ø³ØªØ±Ø¬Ø§Ø¹">â†©ï¸</button>';
            } else {
                let buttons = `
                    <button class="icon-btn success" onclick="createPurchaseOrder(${alert.id})" title="Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡">ğŸ“‹</button>
                    <button class="icon-btn" onclick="markAsRead(${alert.id})" title="ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡">âœ“</button>
                    <button class="icon-btn danger" onclick="ignoreAlert(${alert.id})" title="ØªØ¬Ø§Ù‡Ù„">ğŸš«</button>
                `;
                // NEW: Add Sale Offer button if stock is low or critical
                if (alert.currentStock <= alert.minLevel * 0.5) {
                    buttons += `<button class="icon-btn btn-warning" onclick="createSaleOffer(${alert.id})" title="Ø¥Ø¶Ø§ÙØ© Ù„ØªØ®ÙÙŠØ¶Ø§Øª">ğŸ·ï¸</button>`;
                }
                return buttons;
            }
        }

        function updateStats() {
            const urgent = alerts.filter(a => a.currentStock === 0).length;
            const newAlerts = alerts.filter(a => a.status === 'Ø¬Ø¯ÙŠØ¯').length;
            const solved = alerts.filter(a => a.status === 'Ù…Ø­Ù„ÙˆÙ„').length;
            
            document.getElementById('urgentCount').textContent = urgent;
            document.getElementById('newCount').textContent = newAlerts;
            document.getElementById('solvedCount').textContent = solved;
            document.getElementById('notificationCount').textContent = urgent + newAlerts;
        }

        function updateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ar-EG');
        }

        function filterAlerts() {
            // (Ø¨Ù‚ÙŠØ© Ø¯Ø§Ù„Ø© filterAlerts Ù„Ù… ØªØªØºÙŠØ±)
            const status = document.getElementById('statusFilter').value;
            const product = document.getElementById('productFilter').value.toLowerCase();
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filtered = alerts;
            
            if (status !== 'all') filtered = filtered.filter(a => a.status === status);
            if (product) filtered = filtered.filter(a => a.product.toLowerCase().includes(product));
            if (dateFrom) filtered = filtered.filter(a => new Date(a.alertDate) >= new Date(dateFrom));
            if (dateTo) filtered = filtered.filter(a => new Date(a.alertDate) <= new Date(dateTo));
            
            loadAlerts(filtered);
        }

        function resetFilters() {
            // (Ø¨Ù‚ÙŠØ© Ø¯Ø§Ù„Ø© resetFilters Ù„Ù… ØªØªØºÙŠØ±)
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('productFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            loadAlerts();
        }

        function refreshData() {
            // (Ø¨Ù‚ÙŠØ© Ø¯Ø§Ù„Ø© refreshData Ù„Ù… ØªØªØºÙŠØ±)
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            
            setTimeout(() => {
                loader.style.display = 'none';
                loadAlerts();
                updateStats();
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }, 1500);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        /* ===== NEW FEATURE 1: SALE OFFER MANAGEMENT ===== */

        function createSaleOffer(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            
            document.getElementById('saleModalBody').innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <h3 style="border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Ù…Ù†ØªØ¬ Ø§Ù„ØªØ®ÙÙŠØ¶: ${alert.product}</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                            <div style="color: var(--accent-orange); font-weight: bold; font-size: 18px;">${alert.currentStock} Ù‚Ø·Ø¹Ø©</div>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ø§Ù„Ø´Ø±Ø§Ø¡)</label>
                            <div style="font-weight: 600;">${alert.costPrice.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠ</label>
                            <div style="font-weight: 600; color: var(--accent-green);">${alert.sellingPrice.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="filter-label">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ®ÙÙŠØ¶ (%)</label>
                        <input type="number" id="discountPercent" value="20" min="5" max="90" step="5" style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white; font-size: 16px; font-weight: bold;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="filter-label">Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ®ÙÙŠØ¶</label>
                            <div id="newSellingPrice" style="padding: 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-blue); border-radius: 8px; color: var(--accent-blue); font-size: 18px; font-weight: bold;">-- Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                        <div>
                            <label class="filter-label">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ / Ø§Ù„Ø®Ø³Ø§Ø±Ø©</label>
                            <div id="profitStatus" class="profit-status">--</div>
                        </div>
                    </div>

                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ø£ÙŠØ§Ù…)</label>
                        <input type="number" id="saleDuration" value="7" min="1" style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white;">
                    </div>
                    
                    <div class="btn-group" style="margin-top: 25px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="submitSaleOffer(${alertId})" style="flex: 1;">ğŸ·ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶</button>
                        <button class="btn btn-secondary" onclick="closeModal('saleModal')" style="flex: 1;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            
            // Auto-calculate logic
            function calcSale() {
                const discount = parseFloat(document.getElementById('discountPercent')?.value || 0);
                const originalPrice = alert.sellingPrice;
                const costPrice = alert.costPrice;
                
                if (discount < 0 || discount > 100) return;

                const newPrice = originalPrice * (1 - discount / 100);
                const profit = newPrice - costPrice;

                document.getElementById('newSellingPrice').textContent = newPrice.toFixed(2) + ' Ø¯ÙŠÙ†Ø§Ø±';
                
                const profitElement = document.getElementById('profitStatus');
                if (profitElement) {
                    profitElement.textContent = profit.toFixed(2) + ' Ø¯ÙŠÙ†Ø§Ø±';
                    profitElement.classList.remove('is-profit', 'is-loss');
                    if (profit > 0) {
                        profitElement.classList.add('is-profit');
                        profitElement.textContent += ' (Ø±Ø¨Ø­)';
                    } else if (profit < 0) {
                        profitElement.classList.add('is-loss');
                        profitElement.textContent += ' (Ø®Ø³Ø§Ø±Ø©)';
                    }
                }
            }
            
            document.getElementById('discountPercent')?.addEventListener('input', calcSale);
            calcSale(); // Run on load
            
            document.getElementById('saleModal').style.display = 'flex';
        }

        function submitSaleOffer(alertId) {
            const discount = document.getElementById('discountPercent').value;
            const duration = document.getElementById('saleDuration').value;
            const newPrice = parseFloat(document.getElementById('newSellingPrice').textContent);
            
            if (!discount || !duration) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ®ÙÙŠØ¶ ÙˆÙ…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶!');
                return;
            }
            
            const alertItem = alerts.find(a => a.id === alertId);
            
            // Simulate processing the sale offer
            closeModal('saleModal');
            
            alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„ØªØ®ÙÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­!\n\n` +
                  `Ø§Ù„Ù…Ù†ØªØ¬: ${alertItem.product}\n` +
                  `Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ®ÙÙŠØ¶: ${discount}%\n` +
                  `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${newPrice.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±\n` +
                  `Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: ${document.getElementById('profitStatus').textContent}`);
        }

        /* ===== NEW FEATURE 2: BATCH PURCHASE ORDER ===== */

        function generateBatchPurchaseOrder() {
            // Find products that are at 'Critical' (0) or 'Low' (<= 50% of minLevel) stock
            const batchAlerts = alerts.filter(a => 
                a.currentStock === 0 || a.currentStock <= a.minLevel * 0.5
            ).filter(a => 
                a.status !== 'Ù…Ø­Ù„ÙˆÙ„' && a.status !== 'Ù…ØªØ¬Ø§Ù‡Ù„' // Only include items needing action
            );

            if (batchAlerts.length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØªØ·Ù„Ø¨ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ù…Ø¬Ù…Ø¹ Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ ÙÙ‚Ø·).');
                return;
            }

            // Create a printable format
            let orderList = '## ğŸ“œ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ø¬Ù…Ø¹ Ù„Ù„Ù…ÙˆØ±Ø¯ (Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠØ©)\n\n';
            orderList += `**Ø§Ù„ØªØ§Ø±ÙŠØ®:** ${new Date().toLocaleString('ar-EG')}\n`;
            orderList += `**Ø§Ù„Ø­Ø§Ù„Ø©:** ÙŠØªØ·Ù„Ø¨ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø§Ø¬Ù„\n\n`;
            orderList += '| Ø§Ù„Ù…Ù†ØªØ¬ | Ø¨Ø§Ø±ÙƒÙˆØ¯ | Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ | Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ù‚ØªØ±Ø­) |\n';
            orderList += '| :--- | :--- | :---: | :---: | :---: |\n';

            batchAlerts.forEach(alert => {
                const requiredQty = alert.minLevel * 2; // Suggest buying double the minimum
                orderList += `| ${alert.product} | ${alert.barcode} | ${alert.currentStock} | ${alert.minLevel} | **${requiredQty}** |\n`;
            });

            // Simulate printing/exporting
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ø¬Ù…Ø¹</title>');
            printWindow.document.write('<style>body { direction: rtl; font-family: Tahoma, sans-serif; } table { width: 100%; border-collapse: collapse; margin-top: 20px; } th, td { border: 1px solid #ddd; padding: 8px; text-align: right; } th { background-color: #f2f2f2; }</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(orderList.replace(/\n/g, '<br>').replace(/\|/g, '</td><td>').replace(/<br>\| :---/g, '<thead><tr>').replace(/\|/g, '</td><td>').replace(/\|/g, '').replace(/<br>/g, '').replace('##', '<h1>').replace('**', '<b>').replace('**', '</b>').replace('**', '<b>').replace('**', '</b>'));
            printWindow.document.write('</body></html>');
            
            // A common way to print is to open a window and call print on it.
            // printWindow.print(); // Uncomment this line to enable actual printing
            
            alert('âœ… ØªÙ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©/Ø§Ù„ØªØµØ¯ÙŠØ±.');
        }

        /* ===== (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù… ØªØªØºÙŠØ±) ===== */

        function createPurchaseOrder(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            const suggestedQty = alert.minLevel * 2;
            
            document.getElementById('purchaseModalBody').innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ù…Ù†ØªØ¬</label>
                            <div style="font-weight: 600; font-size: 16px;">${alert.product}</div>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
                            <div style="font-family: monospace;">${alert.barcode}</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                            <div style="color: #ef4444; font-weight: bold; font-size: 18px;">${alert.currentStock} Ù‚Ø·Ø¹Ø©</div>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</label>
                            <div style="font-weight: 600;">${alert.minLevel} Ù‚Ø·Ø¹Ø©</div>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ù†Ù‚Øµ</label>
                            <div style="color: #ef4444; font-weight: bold;">${alert.minLevel - alert.currentStock} Ù‚Ø·Ø¹Ø©</div>
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù„Ø´Ø±Ø§Ø¡</label>
                        <input type="number" id="purchaseQty" value="${suggestedQty}" min="1" style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white; font-size: 16px; font-weight: bold;">
                        <small style="color: #64748b;">Ù…Ù‚ØªØ±Ø­: ${alert.minLevel} Ã— 2 = ${suggestedQty} Ù‚Ø·Ø¹Ø©</small>
                    </div>
                    
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                        <select id="supplier" style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white;">
                            <option>Ù…Ø­Ù…Ø¯ Ù„Ù„Ø£Ø²ÙŠØ§Ø¡ (Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                            <option>Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ù…Ù„Ø§Ø¨Ø³</option>
                            <option>ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
                            <input type="number" id="unitPrice" placeholder="0.00" value="${alert.costPrice}" style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                            <div id="totalPrice" style="padding: 12px; background: rgba(16,185,129,0.1); border: 1px solid var(--accent-green); border-radius: 8px; color: var(--accent-green); font-size: 18px; font-weight: bold;">-- Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <textarea id="notes" rows="3" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ù„Ø¨..." style="width: 100%; padding: 12px; background: rgba(15,23,42,0.5); border: 1px solid var(--border-color); border-radius: 8px; color: white; resize: vertical;"></textarea>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 25px;">
                        <button class="btn btn-primary" onclick="submitPurchase(${alertId})" style="flex: 1;">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                        <button class="btn btn-secondary" onclick="closeModal('purchaseModal')" style="flex: 1;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            function calcTotal() {
                const qty = parseInt(document.getElementById('purchaseQty')?.value || 0);
                const price = parseFloat(document.getElementById('unitPrice')?.value || 0);
                const total = qty * price;
                const totalField = document.getElementById('totalPrice');
                if (totalField) {
                    totalField.textContent = total.toFixed(2) + ' Ø¯ÙŠÙ†Ø§Ø±';
                }
            }
            
            document.getElementById('purchaseQty')?.addEventListener('input', calcTotal);
            document.getElementById('unitPrice')?.addEventListener('input', calcTotal);

            calcTotal(); // Calculate initial total
            
            document.getElementById('purchaseModal').style.display = 'flex';
        }

        function submitPurchase(alertId) {
            const qty = document.getElementById('purchaseQty').value;
            const price = document.getElementById('unitPrice').value;
            
            if (!qty || !price) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø³Ø¹Ø±!');
                return;
            }
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            const alert = alerts.find(a => a.id === alertId);
            alert.status = 'Ù…Ø­Ù„ÙˆÙ„';
            
            closeModal('purchaseModal');
            loadAlerts();
            updateStats();
            
            alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!\n\n' +
                  `Ø§Ù„Ø·Ù„Ø¨: ${alert.product}\n` +
                  `Ø§Ù„ÙƒÙ…ÙŠØ©: ${qty} Ù‚Ø·Ø¹Ø©\n` +
                  `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${(qty * price).toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±\n` +
                  `Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: PO-${Date.now()}`);
        }

        function markAsRead(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            if (alert && alert.status === 'Ø¬Ø¯ÙŠØ¯') {
                alert.status = 'Ù…Ù‚Ø±ÙˆØ¡';
                loadAlerts();
                updateStats();
            }
        }

        function ignoreAlert(alertId) {
            if (confirm('ğŸš« Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ØŸ')) {
                const reason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØªØ¬Ø§Ù‡Ù„:');
                if (reason) {
                    const alert = alerts.find(a => a.id === alertId);
                    alert.status = 'Ù…ØªØ¬Ø§Ù‡Ù„';
                    alert.ignoreReason = reason;
                    loadAlerts();
                    updateStats();
                    alert('âœ… ØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.');
                }
            }
        }

        function restoreAlert(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            if (alert) {
                alert.status = 'Ø¬Ø¯ÙŠØ¯';
                loadAlerts();
                updateStats();
                alert('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.');
            }
        }

        function viewDetails(alertId) {
            const alertItem = alerts.find(a => a.id === alertId);
            alert('ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:\n\n' +
                  `Ø§Ù„Ù…Ù†ØªØ¬: ${alertItem.product}\n` +
                  `Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${alertItem.barcode}\n` +
                  `Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${alertItem.currentStock}\n` +
                  `Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: ${alertItem.minLevel}\n` +
                  `Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: ${alertItem.costPrice.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±\n` +
                  `Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹: ${alertItem.sellingPrice.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±\n` +
                  `Ø§Ù„Ø­Ø§Ù„Ø©: ${alertItem.status}\n` +
                  `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${alertItem.alertDate}`);
        }

        function simulateNewAlert() {
            const products = ['Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ 42', 'Ù‚Ù…ÙŠØµ Ù…Ø®Ø·Ø· M', 'Ø¨Ù†Ø·Ù„ÙˆÙ† ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ L', 'Ø¬Ø§ÙƒÙŠØª Ø¬ÙŠÙ†Ø² XL'];
            const costPrices = [70, 45, 120, 180];
            const sellingPrices = [120, 80, 200, 320];
            const randomIndex = Math.floor(Math.random() * products.length);
            
            const newAlert = {
                id: alerts.length + 1,
                product: products[randomIndex],
                barcode: Math.floor(Math.random() * 900000000) + 100000000,
                currentStock: Math.floor(Math.random() * 3),
                minLevel: 10,
                alertDate: new Date().toLocaleString('ar-EG'),
                status: 'Ø¬Ø¯ÙŠØ¯',
                category: 'Ù…Ù„Ø§Ø¨Ø³ Ø±Ø¬Ø§Ù„ÙŠØ©',
                costPrice: costPrices[randomIndex],
                sellingPrice: sellingPrices[randomIndex]
            };
            
            alerts.unshift(newAlert);
            loadAlerts();
            updateStats();
            
            // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†Ø¨Ø«Ù‚
            const popup = document.getElementById('popupNotification');
            document.getElementById('popupMessage').textContent = `${newAlert.product} - Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${newAlert.currentStock}`;
            popup.style.display = 'block';
            setTimeout(() => popup.style.display = 'none', 5000);
        }

        function exportToExcel() {
            alert('ğŸ“¤ Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel...');
        }

        function printAlerts() {
            alert('ğŸ–¨ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...');
        }

        function showNotifications() {
            alert('ğŸ”” 3 ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ØªØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ!');
        }
    </script>
</body>
</html>

